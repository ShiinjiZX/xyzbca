<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node.js Web Terminal - Vercel Ready</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Lucide Icons as SVG components
        const Terminal = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="4 17 10 11 4 5"></polyline>
                <line x1="12" y1="19" x2="20" y2="19"></line>
            </svg>
        );

        const Play = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Square = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const FolderOpen = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const FileText = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );

        const Archive = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="21 8 21 21 3 21 3 8"></polyline>
                <rect x="1" y="3" width="22" height="5"></rect>
                <line x1="10" y1="12" x2="14" y2="12"></line>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Github = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>
        );

        const Save = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );

        const Folder = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        function NodeTerminal() {
            const [isRunning, setIsRunning] = useState(false);
            const [output, setOutput] = useState([]);
            const [command, setCommand] = useState('');
            const [files, setFiles] = useState({});
            const [currentFile, setCurrentFile] = useState('index.js');
            const [currentContent, setCurrentContent] = useState('');
            const [fileTree, setFileTree] = useState([]);
            const outputRef = useRef(null);

            useEffect(() => {
                loadFromStorage();
            }, []);

            useEffect(() => {
                if (outputRef.current) {
                    outputRef.current.scrollTop = outputRef.current.scrollHeight;
                }
            }, [output]);

            const loadFromStorage = () => {
                try {
                    const stored = localStorage.getItem('nodejs-files');
                    if (stored) {
                        const filesData = JSON.parse(stored);
                        setFiles(filesData);
                        updateFileTree(filesData);
                        addOutput('Files loaded from storage', 'success');
                    }
                } catch (err) {
                    addOutput('Starting fresh session', 'info');
                }
            };

            const saveToStorage = (filesData) => {
                try {
                    localStorage.setItem('nodejs-files', JSON.stringify(filesData));
                } catch (err) {
                    addOutput('Failed to save files', 'error');
                }
            };

            const updateFileTree = (filesData) => {
                const tree = Object.keys(filesData).map(path => ({
                    name: path.split('/').pop(),
                    path: path,
                }));
                setFileTree(tree);
            };

            const addOutput = (text, type = 'output') => {
                setOutput(prev => [...prev, { text, type, timestamp: new Date().toLocaleTimeString() }]);
            };

            const handleZipUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    addOutput(`Uploading ${file.name}...`, 'info');
                    
                    const zip = new JSZip();
                    const contents = await zip.loadAsync(file);
                    
                    const newFiles = { ...files };
                    let extractedCount = 0;

                    for (const [path, zipEntry] of Object.entries(contents.files)) {
                        if (!zipEntry.dir) {
                            const content = await zipEntry.async('string');
                            newFiles[path] = content;
                            extractedCount++;
                        }
                    }

                    setFiles(newFiles);
                    updateFileTree(newFiles);
                    saveToStorage(newFiles);
                    
                    addOutput(`Extracted ${extractedCount} files from ${file.name}`, 'success');
                    
                    const firstJsFile = Object.keys(newFiles).find(f => f.endsWith('.js'));
                    if (firstJsFile) {
                        setCurrentFile(firstJsFile);
                        setCurrentContent(newFiles[firstJsFile]);
                    }
                } catch (err) {
                    addOutput(`Error extracting ZIP: ${err.message}`, 'error');
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const newFiles = { ...files, [file.name]: event.target.result };
                    setFiles(newFiles);
                    setCurrentFile(file.name);
                    setCurrentContent(event.target.result);
                    updateFileTree(newFiles);
                    saveToStorage(newFiles);
                    addOutput(`File uploaded: ${file.name}`, 'success');
                };
                reader.readAsText(file);
            };

            const createNewFile = () => {
                const fileName = prompt('Enter file name (e.g., server.js):');
                if (fileName) {
                    const newFiles = { ...files, [fileName]: '' };
                    setFiles(newFiles);
                    setCurrentFile(fileName);
                    setCurrentContent('');
                    updateFileTree(newFiles);
                    saveToStorage(newFiles);
                    addOutput(`Created new file: ${fileName}`, 'success');
                }
            };

            const saveCurrentFile = () => {
                const newFiles = { ...files, [currentFile]: currentContent };
                setFiles(newFiles);
                saveToStorage(newFiles);
                addOutput(`Saved: ${currentFile}`, 'success');
            };

            const downloadAsZip = async () => {
                try {
                    const zip = new JSZip();

                    for (const [path, content] of Object.entries(files)) {
                        zip.file(path, content);
                    }

                    const blob = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'nodejs-project.zip';
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    addOutput('Project downloaded as ZIP', 'success');
                } catch (err) {
                    addOutput(`Error creating ZIP: ${err.message}`, 'error');
                }
            };

            const executeCommand = (cmd) => {
                addOutput(`$ ${cmd}`, 'command');
                
                const parts = cmd.trim().split(' ');
                const mainCmd = parts[0];
                const args = parts.slice(1);

                try {
                    switch(mainCmd) {
                        case 'node':
                            if (args[0] && files[args[0]]) {
                                executeNodeScript(files[args[0]]);
                            } else {
                                addOutput(`Error: File '${args[0]}' not found`, 'error');
                            }
                            break;
                        
                        case 'npm':
                            if (args[0] === 'start') {
                                if (files['index.js']) {
                                    executeNodeScript(files['index.js']);
                                } else {
                                    addOutput('Error: index.js not found', 'error');
                                }
                            } else if (args[0] === 'install') {
                                addOutput('npm install - Package installed (simulated)', 'success');
                            } else {
                                addOutput(`npm ${args.join(' ')} - Command executed (simulated)`, 'info');
                            }
                            break;
                        
                        case 'ls':
                            Object.keys(files).forEach(f => addOutput(f, 'output'));
                            break;
                        
                        case 'cat':
                            if (files[args[0]]) {
                                addOutput(files[args[0]], 'output');
                            } else {
                                addOutput(`cat: ${args[0]}: No such file`, 'error');
                            }
                            break;
                        
                        case 'rm':
                            if (files[args[0]]) {
                                const newFiles = { ...files };
                                delete newFiles[args[0]];
                                setFiles(newFiles);
                                updateFileTree(newFiles);
                                saveToStorage(newFiles);
                                addOutput(`Removed: ${args[0]}`, 'success');
                            } else {
                                addOutput(`rm: ${args[0]}: No such file`, 'error');
                            }
                            break;
                        
                        case 'clear':
                            setOutput([]);
                            break;
                        
                        case 'help':
                            addOutput('Available commands:', 'info');
                            addOutput('  node <file> - Run Node.js file', 'info');
                            addOutput('  npm start - Run index.js', 'info');
                            addOutput('  npm install - Install packages', 'info');
                            addOutput('  ls - List files', 'info');
                            addOutput('  cat <file> - Show file content', 'info');
                            addOutput('  rm <file> - Remove file', 'info');
                            addOutput('  clear - Clear console', 'info');
                            addOutput('  help - Show this help', 'info');
                            break;
                        
                        default:
                            addOutput(`Command not found: ${mainCmd}`, 'error');
                            addOutput('Type "help" for available commands', 'info');
                    }
                } catch (error) {
                    addOutput(`Error: ${error.message}`, 'error');
                }
            };

            const executeNodeScript = (script) => {
                try {
                    addOutput('Starting Node.js process...', 'info');
                    
                    const logs = [];
                    const mockConsole = {
                        log: (...args) => logs.push(args.join(' ')),
                        error: (...args) => logs.push('ERROR: ' + args.join(' ')),
                        warn: (...args) => logs.push('WARN: ' + args.join(' '))
                    };
                    
                    const wrappedScript = `
                        (function() {
                            const console = mockConsole;
                            const require = (module) => {
                                mockConsole.log('Module loaded: ' + module);
                                return {};
                            };
                            ${script}
                        })()
                    `;
                    
                    try {
                        eval(wrappedScript);
                        logs.forEach(log => addOutput(log, 'output'));
                        addOutput('Process exited with code 0', 'success');
                    } catch (err) {
                        addOutput(`Runtime Error: ${err.message}`, 'error');
                    }
                } catch (error) {
                    addOutput(`Execution Error: ${error.message}`, 'error');
                }
            };

            const handleStart = () => {
                if (!currentContent) {
                    addOutput('Error: No script loaded. Please select a file.', 'error');
                    return;
                }
                setIsRunning(true);
                addOutput('=== Starting Node.js Environment ===', 'info');
                addOutput(`Running: ${currentFile}`, 'info');
                executeNodeScript(currentContent);
                setIsRunning(false);
            };

            const handleStop = () => {
                setIsRunning(false);
                addOutput('=== Process Stopped (SIGTERM) ===', 'info');
            };

            const loadExampleProject = () => {
                const exampleFiles = {
                    'index.js': `// Express Server Example
const express = require('express');
const app = express();
const PORT = 3000;

console.log('Starting Express server...');

app.get('/', (req, res) => {
  res.send('Hello World!');
});

console.log(\`Server running on port \${PORT}\`);
console.log('Server started successfully!');`,
                    
                    'package.json': `{
  "name": "nodejs-web-terminal",
  "version": "1.0.0",
  "description": "Node.js Web Terminal",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "express": "^4.18.0"
  }
}`,
                    
                    'utils.js': `// Utility functions
function formatDate(date) {
  return date.toISOString();
}

function generateId() {
  return Math.random().toString(36).substr(2, 9);
}

console.log('Utils module loaded');
module.exports = { formatDate, generateId };`,
                    
                    'README.md': `# Node.js Web Terminal Project

This is an example Node.js project running in a web-based terminal.

## Features
- Express web server
- Utility functions
- Console monitoring

## Usage
Run: npm start`
                };
                
                setFiles(exampleFiles);
                updateFileTree(exampleFiles);
                setCurrentFile('index.js');
                setCurrentContent(exampleFiles['index.js']);
                saveToStorage(exampleFiles);
                addOutput('Example project loaded', 'success');
            };

            const getOutputColor = (type) => {
                switch(type) {
                    case 'command': return 'text-blue-400';
                    case 'error': return 'text-red-400';
                    case 'success': return 'text-green-400';
                    case 'info': return 'text-yellow-400';
                    default: return 'text-gray-300';
                }
            };

            return (
                <div className="min-h-screen bg-gray-900 p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-gray-800 rounded-t-lg p-4 border-b border-gray-700">
                            <div className="flex items-center justify-between flex-wrap gap-3">
                                <div className="flex items-center gap-3">
                                    <Terminal size={28} className="text-green-400" />
                                    <h1 className="text-2xl font-bold text-white">Node.js Terminal Panel</h1>
                                    <Github size={20} className="text-gray-400" />
                                </div>
                                <div className="flex gap-2 flex-wrap">
                                    <button
                                        onClick={handleStart}
                                        disabled={isRunning}
                                        className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white rounded-lg transition-colors text-sm"
                                    >
                                        <Play size={16} />
                                        Start
                                    </button>
                                    <button
                                        onClick={handleStop}
                                        disabled={!isRunning}
                                        className="flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white rounded-lg transition-colors text-sm"
                                    >
                                        <Square size={16} />
                                        Stop
                                    </button>
                                    <button
                                        onClick={() => setOutput([])}
                                        className="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors text-sm"
                                    >
                                        <Trash2 size={16} />
                                        Clear
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-4 mt-4">
                            <div className="lg:col-span-1 bg-gray-800 rounded-lg p-4 h-fit">
                                <h2 className="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                                    <FolderOpen size={18} className="text-blue-400" />
                                    File Manager
                                </h2>
                                
                                <div className="space-y-2 mb-4">
                                    <label className="flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded cursor-pointer transition-colors w-full justify-center">
                                        <Archive size={16} />
                                        Import ZIP
                                        <input
                                            type="file"
                                            accept=".zip"
                                            onChange={handleZipUpload}
                                            className="hidden"
                                        />
                                    </label>
                                    
                                    <label className="flex items-center gap-2 px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded cursor-pointer transition-colors w-full justify-center">
                                        <Upload size={16} />
                                        Upload File
                                        <input
                                            type="file"
                                            accept=".js,.json,.md,.txt"
                                            onChange={handleFileUpload}
                                            className="hidden"
                                        />
                                    </label>
                                    
                                    <button
                                        onClick={createNewFile}
                                        className="flex items-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors w-full justify-center"
                                    >
                                        <FileText size={16} />
                                        New File
                                    </button>
                                    
                                    <button
                                        onClick={downloadAsZip}
                                        className="flex items-center gap-2 px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded transition-colors w-full justify-center"
                                    >
                                        <Download size={16} />
                                        Export ZIP
                                    </button>
                                    
                                    <button
                                        onClick={loadExampleProject}
                                        className="flex items-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white text-sm rounded transition-colors w-full justify-center"
                                    >
                                        <Folder size={16} />
                                        Load Example
                                    </button>
                                </div>

                                <div className="border-t border-gray-700 pt-3">
                                    <div className="text-xs text-gray-400 mb-2 font-semibold">PROJECT FILES</div>
                                    <div className="space-y-1 max-h-96 overflow-y-auto">
                                        {fileTree.length === 0 ? (
                                            <div className="text-gray-500 text-sm py-2">No files yet</div>
                                        ) : (
                                            fileTree.map((file, i) => (
                                                <button
                                                    key={i}
                                                    onClick={() => {
                                                        setCurrentFile(file.path);
                                                        setCurrentContent(files[file.path]);
                                                    }}
                                                    className={`w-full text-left px-3 py-2 rounded text-sm flex items-center gap-2 transition-colors ${
                                                        currentFile === file.path 
                                                            ? 'bg-blue-600 text-white' 
                                                            : 'text-gray-300 hover:bg-gray-700'
                                                    }`}
                                                >
                                                    <FileText size={14} />
                                                    {file.name}
                                                </button>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>

                            <div className="lg:col-span-3 space-y-4">
                                <div className="bg-gray-800 rounded-lg p-4">
                                    <div className="flex items-center justify-between mb-3">
                                        <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                            <FileText size={18} className="text-green-400" />
                                            Editor: {currentFile}
                                        </h2>
                                        <button
                                            onClick={saveCurrentFile}
                                            className="flex items-center gap-2 px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors"
                                        >
                                            <Save size={14} />
                                            Save
                                        </button>
                                    </div>
                                    <textarea
                                        value={currentContent}
                                        onChange={(e) => setCurrentContent(e.target.value)}
                                        className="w-full h-64 bg-gray-900 text-gray-300 font-mono text-sm p-4 rounded border border-gray-700 focus:border-blue-500 focus:outline-none resize-none"
                                        placeholder="// Select or create a file to start editing"
                                    />
                                </div>

                                <div className="bg-gray-800 rounded-lg p-4">
                                    <h2 className="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                                        <Terminal size={18} className="text-green-400" />
                                        Console
                                        {isRunning && (
                                            <span className="ml-auto text-xs bg-green-600 text-white px-2 py-1 rounded animate-pulse">
                                                Running
                                            </span>
                                        )}
                                    </h2>
                                    <div
                                        ref={outputRef}
                                        className="bg-black rounded border border-gray-700 p-4 h-64 overflow-y-auto font-mono text-sm"
                                    >
                                        {output.length === 0 ? (
                                            <div className="text-gray-500">
                                                <div>Node.js Web Terminal v1.0.0</div>
                                                <div>Type 'help' for available commands</div>
                                            </div>
                                        ) : (
                                            output.map((line, i) => (
                                                <div key={i} className={`${getOutputColor(line.type)} mb-1`}>
                                                    <span className="text-gray-600 text-xs mr-2">[{line.timestamp}]</span>
                                                    {line.text}
                                                </div>
                                            ))
                                        )}
                                    </div>

                                    <div className="mt-3 flex gap-2">
                                        <input
                                            type="text"
                                            value={command}
                                            onChange={(e) => setCommand(e.target.value)}
                                            onKeyPress={(e) => {
                                                if (e.key === 'Enter') {
                                                    if (command.trim()) {
                                                        executeCommand(command);
                                                        setCommand('');
                                                    }
                                                }
                                            }}
                                            placeholder="$ node index.js"
                                            className="flex-1 bg-gray-900 text-gray-300 px-4 py-2 rounded border border-gray-700 focus:border-blue-500 focus:outline-none font-mono text-sm"
                                        />
                                        <button
                                            onClick={() => {
                                                if (command.trim()) {
                                                    executeCommand(command);
                                                    setCommand('');
                                                }
                                            }}
                                            className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors"
                                        >
                                            Execute
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<NodeTerminal />, document.getElementById('root'));
    </script>
</body>
</html>